<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Segoe UI";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Liberation Sans";}
@font-face
	{font-family:"Source Han Sans CN";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Droid Sans Devanagari";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:0in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
.MsoChpDefault
	{font-family:"Calibri",sans-serif;}
@page WordSection1
	{size:595.3pt 841.9pt;
	margin:56.7pt 42.5pt 56.7pt 85.05pt;}
div.WordSection1
	{page:WordSection1;}
-->
</style>

</head>

<body lang=EN-US style='word-wrap:break-word'>

<div class=WordSection1>
<h1>
<p class=MsoNormal><span lang=RU style='font-size:20.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Задачи со случайностями. Автор: Иванов
Дмитрий </span></p></h1>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Как говорил один известный персонаж —
«Случайности не случайны». Так и эти задачи из различных </span><span
style='font-size:14.0pt;line-height:107%;font-family:"Times New Roman",serif'>CTF</span><span
lang=RU style='font-size:14.0pt;line-height:107%;font-family:"Times New Roman",serif'>-соревнований
доказывают, что случайные на первый взгляд числа, на самом деле взяли не случайно.</span></p>

<p class=MsoNormal><b><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Первая</span></b><b><span lang=RU
style='font-size:14.0pt;line-height:107%;font-family:"Times New Roman",serif'> </span></b><b><span
lang=RU style='font-size:14.0pt;line-height:107%;font-family:"Times New Roman",serif'>задача</span></b></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>«Not very random»</span></b></p>

<p class=MsoNormal><i><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>В этот раз агенту попалось новое послание.
Более того, удалось перехватить и программу, которая его сгенерировала.</span></i></p>

<p class=MsoNormal><i><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Алгоритм получения шифротекста был бы
простым, если бы не использование случайных чисел. К счастью, агент знает, что
в момент генерации послания на часах было&nbsp;2020-10-17T18:46:39+00:00.
Помогите ему расшифровать текст.</span></i></p>

<p class=MsoNormal><i><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>nkbi{k4an0b_wc0cq_b9_oz0x_6lwamh94ab}</span></i></p>

<p class=MsoNormal><i><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>&nbsp;</span></i></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>import random</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>import time</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>source =
&quot;?????????????????????????????????????&quot;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>cipher_text = &quot;&quot;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>seed = int(time.time())</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>random.seed(seed)</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>def shift_in_alphabet(ch, alphabet_size,
alphabet_start, shift):</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>    return chr((ord(ch) -
ord(alphabet_start) + shift) % alphabet_size + ord(alphabet_start))</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>&nbsp;</span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:#538135'>for c in source:</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>    if c.islower():</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>        cipher_text +=
shift_in_alphabet(c, 26, 'a', random.randint(0, 26))</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>    elif c.isdigit():</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>        cipher_text +=
shift_in_alphabet(c, 10, '0', random.randint(0, 10))</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>    else:</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>        cipher_text += c</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#538135'>print(&quot;Random message: &quot;,
cipher_text)</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Изучив работу скрипта, понимаем, что одним
из его действий является сдвиг символа в алфавите, причем циклический и главная
проблема, что значение смещения случайно.</span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Однако, в начале кода замечаем, что
случайность зависит от времени на устройстве, которое было дано в условии.
Выходит, что </span><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif'>seed</span><span lang=RU style='font-size:14.0pt;
line-height:107%;font-family:"Times New Roman",serif'> определяется из времени,
а из </span><span style='font-size:14.0pt;line-height:107%;font-family:"Times New Roman",serif'>seed</span><span
lang=RU style='font-size:14.0pt;line-height:107%;font-family:"Times New Roman",serif'>’а
уже случайные числа.</span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Переводим дату и время из условия в
unix-timestamp, подставляем в seed, меняем значение сдвига на противоположное,
запускаем скрипт и получаем флаг.</span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Флаг</span><span style='font-size:14.0pt;
line-height:107%;font-family:"Times New Roman",serif'>: flag{r4nd0m_sh0ld_b3_us3d_4ccura73ly}</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif'>&nbsp;</span></p>



<p class=MsoNormal><b><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:#111111'>Вторая задача</span></b></p>

<p class=MsoNormal><b><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:#111111'>«random»</span></b></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:#111111'><br>
<span style='background:white'>Нажимаем на иконку с подписью random, и нам
говорят, что нужно подключиться по SSH с паролем guest.</span></span></p>

<p class=MsoNormal><span lang=RU><img width=624 height=394 id="Рисунок 1"
src="tasks_with_random_files/image001.png" alt=image></span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:#111111;background:white'>Так как мы
можем прочитать исходный код программы, так как есть право читать для всех, и
выполнить с правами владельца программу random (установлен sticky-бит). Давай
просмотрим исход код.</span></p>

<p class=MsoNormal><span lang=RU><img width=624 height=314 id="Рисунок 3"
src="tasks_with_random_files/image002.png" alt=image></span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:#111111;background:white'>Программа
генерирует случайное число, применяет операцию XOR (исключающее ИЛИ), и если
результат операции XOR равен эталонному значению, выводит флаг.</span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:#111111;background:white'>В данной
программе в самом начале используется функция </span><span style='font-size:
14.0pt;line-height:107%;font-family:"Times New Roman",serif;color:#111111;
background:white'>rand</span><span lang=RU style='font-size:14.0pt;line-height:
107%;font-family:"Times New Roman",serif;color:#111111;background:white'>(),
которая генерирует псевдослучайное число, преобразуя “зерно”, сгенерированное
функцией srand(). Функция srand(number) должна вызываться каждый раз перед
вызовом rand(). Если такого не происходит, то по умолчанию перед rand()
срабатывает srand(1).</span><span lang=RU style='font-size:14.0pt;line-height:
107%;font-family:"Times New Roman",serif;color:#111111'><br>
<br>
<span style='background:white'>Таким образом, в данной программе генератор
псевдослучайного числа каждый раз преобразует по одному и тому же алгоритму
один и тот же </span></span><span style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:#111111;background:white'>seed</span><span
lang=RU style='font-size:14.0pt;line-height:107%;font-family:"Times New Roman",serif;
color:#111111;background:white'>”. Нам необходимо узнать число, которое
возвращает функция rand(), и проксорить с эталонным значением. Так как операция
XOR обратима, то подавая на вход программе полученной значение, мы получим
флаг.</span><span lang=RU style='font-size:14.0pt;line-height:107%;font-family:
"Times New Roman",serif;color:#111111'><br>
<br>
<span style='background:white'>Следующим шагом перехватываем данные между
библиотечной функцией rand() и нашей программой. Для этого используем утилиту
ltrace.</span></span></p>

<p class=MsoNormal><i><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:black;background:#FBFDFF'>ltrace
./random</span></i></p>

<p class=MsoNormal><span lang=RU><img width=623 height=74 id="Рисунок 4"
src="tasks_with_random_files/image003.png" alt=image></span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:#111111;background:white'>Мы видим с
какими параметрами вызывается функция rand() и какое значение она возвращает.
Теперь проксорим это значение с эталонным.</span></p>

<p class=MsoNormal><span lang=RU><img width=333 height=40 id="Рисунок 5"
src="tasks_with_random_files/image004.png" alt=image></span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif;color:#111111;background:white'>Используем
полученное число в нашей программе.</span></p>

<p class=MsoNormal><span lang=RU><img width=610 height=79 id="Рисунок 6"
src="tasks_with_random_files/image005.png" alt=image></span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>&nbsp;</span></p>


<p class=MsoNormal><b><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Третья задача</span></b></p>

<p class=MsoNormal><b><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>«Хайповая математика»</span></b></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Итак, нам дан код, шифрующий флаг и сам
шифротекст</span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=RU><img width=483 height=298 id="Рисунок 11"
src="tasks_with_random_files/image006.jpg"
alt="Разбор отборочного этапа MIEM CTF 2k18, изображение №7"></span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Видим, что используется линейный
конгруэнтный генератор для получения псевдослучайных чисел, с которыми побайтно
ксорится флаг, причем параметры LCG нам известны, не считая начального
состояния.Но, к счастью, у нас есть устойчивый формат флага MIEM{}. </span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>То есть мы знаем первые 5 байт
плэйнтекста. Но нам достаточно и одного, чтобы узнать начальное состояние
генератора. </span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Для этого поксорим первый байт шифротекста
и букву 'M'. А дальше остается лишь сгенерировать достаточное количество чисел
и расшифровать текст пользуясь тем, что если a^b=c, то a=c^b.<br>
<br>
</span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>Пример решения на питоне:</span></p>

<p class=MsoNormal><span lang=RU><img width=339 height=162 id="Рисунок 10"
src="tasks_with_random_files/image007.jpg"
alt="Разбор отборочного этапа MIEM CTF 2k18, изображение №8"></span></p>

<p class=MsoNormal><span lang=RU><img width=554 height=85 id="Рисунок 9"
src="tasks_with_random_files/image008.jpg"
alt="Разбор отборочного этапа MIEM CTF 2k18, изображение №9"></span></p>

<p class=MsoNormal><span lang=RU style='font-size:14.0pt;line-height:107%;
font-family:"Times New Roman",serif'>&nbsp;</span></p>

</div>

</body>

</html>
